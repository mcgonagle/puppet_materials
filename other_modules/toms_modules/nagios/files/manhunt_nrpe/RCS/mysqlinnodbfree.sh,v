head	1.6;
access;
symbols;
locks; strict;
comment	@# @;


1.6
date	2010.03.10.15.46.14;	author kpanacy;	state Exp;
branches;
next	1.5;

1.5
date	2010.03.09.20.58.41;	author kpanacy;	state Exp;
branches;
next	1.4;

1.4
date	2010.03.09.19.19.13;	author kpanacy;	state Exp;
branches;
next	1.3;

1.3
date	2010.03.09.16.52.32;	author kpanacy;	state Exp;
branches;
next	1.2;

1.2
date	2007.12.21.18.59.18;	author rbraun;	state Exp;
branches;
next	1.1;

1.1
date	2007.12.21.18.58.50;	author rbraun;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Corrected puppet comment at top of file
@
text
@#! /bin/sh

# Auto-installed by puppet from /var/ftp/depot/source/olb/nagios-nrpe on Ovulator01/02

STATE_OK=0
STATE_WARNING=1
STATE_CRITICAL=2
STATE_UNKNOWN=3
STATE_DEPENDENT=4
warn=2048
crit=1024
db=manhunt
null="NULL"
usage1="Usage: $0 -H <host> -u user -p password [-w <warn>] [-c <crit>]"
usage2="<warn> is kB to warn at.  Default is 2048."
usage3="<crit> is kB to be critical at.  Default is 1024."

exitstatus=$STATE_WARNING #default
while test -n "$1"; do
    case "$1" in
        -c)
            crit=$2
            shift
            ;;
        -w)
            warn=$2
            shift
            ;;
        -u)
            user=$2
            shift
            ;;
        -p)
            pass=$2
            shift
            ;;
        -h)
            echo $usage1;
	    echo 
            echo $usage2;
            echo $usage3;
            exit $STATE_UNKNOWN
	    ;;
	-H)
            host=$2
            shift
            ;;
        *)
            echo "Unknown argument: $1"
            echo $usage1;
	    echo 
            echo $usage2;
            echo $usage3;
            exit $STATE_UNKNOWN
            ;;
    esac
    shift
done

for db in `mysql -u $user -p$pass -h $host -se 'show databases'`
do
# echo $db
dbfreespace=`mysql -u $user -p$pass -h $host $db  -e 'show table status where Engine="InnoDB"\G' | awk '/free:/ {print $2}' | head -1`
# echo mmm $dbfreespace mmm
if [ "$dbfreespace" != '' ]; then
if [ $dbfreespace != $null ]; then
if [ $dbfreespace != 0 ]; then
freespace=$dbfreespace
echo $host has $freespace kB free!
break
fi
fi
fi
done

# on the number line, we need to test 6 cases:
# 0-----w-----c----->
# 0, 0<lag<w, w, w<lag<c, c, c<lag
# which we simplify to
# lag>=c, w<=lag<c, 0<=lag<warn

# if null, critical
if [ "$freespace" = '' ]; then
exit $STATE_CRITICAL;
fi

if [ $freespace -eq 0 ]; then
exit $STATE_CRITICAL;
fi

# if null, critical
if [ $freespace = $null ]; then
exit $STATE_CRITICAL;
fi

#w<=lag<c
if [ $freespace -lt $warn ]; then
if [ $freespace -ge $crit ]; then
exit $STATE_WARNING;
fi
fi

if [ $freespace -lt $crit ]; then
exit $STATE_CRITICAL;
fi

# 0<=lag<warn
if [ $freespace -gt $warn ]; then
exit $STATE_OK;
fi

@


1.5
log
@assured InnoDB tables are read
@
text
@d3 1
a3 1
# Autogenerated for <%= fqdn %> by puppet
@


1.4
log
@added auto-generated line per Jason's instruction
@
text
@d63 1
a63 1
dbfreespace=`mysql -u $user -p$pass -h $host $db  -e 'show table status\G' | awk '/free:/ {print $2}' | head -1`
@


1.3
log
@sys-2748 fix for false innodbfree messages
@
text
@d3 2
@


1.2
log
@Sheeri's fix from 20-Nov
@
text
@d58 1
a58 1
for db in `/usr/bin/mysql -u $user -p$pass -h $host -se 'show databases'`
d60 4
a63 2
dbfreespace=`/usr/bin/mysql -u $user -p$pass $db -h $host -e 'show table status\G' | /bin/awk '/InnoDB free:/ {print $4}' | /usr/bin/head -1`
if [ $dbfreespace != '' ]; then
d67 1
a73 2
echo $host has $freespace kB free

d77 1
a77 1
# which we simplify to 
d81 1
a81 1
if [ $freespace == '' ]; then 
d83 1
a83 1
fi 
d85 1
a85 1
if [ $freespace == 0 ]; then 
d90 1
a90 1
if [ $freespace == $null ]; then 
d95 2
a96 2
if [ $freespace -lt $warn ]; then 
if [ $freespace -ge $crit ]; then 
d101 1
a101 1
if [ $freespace -lt $crit ]; then 
d106 1
a106 1
if [ $freespace -gt $warn ]; then 
d109 1
@


1.1
log
@Initial revision
@
text
@d12 1
a12 1
usage1="Usage: $0 -H <host> -u user -p password -d dbname [-w <warn>] [-c <crit>]"
a22 4
        -d)
            db=$2
            shift
            ;;
d58 12
a69 1
freespace=`/usr/bin/mysql -u $user -p$pass $db -h $host -e 'show table status\G' | /bin/awk '/InnoDB free:/ {print $4}' | /usr/bin/head -1`
d80 9
@
